---
- hosts: all
  become: true
  vars: 
    my_user: veeam
    my_group: veeam
  tasks:
  - name: Allow 'veeam' user to have passwordless sudo
    ansible.builtin.lineinfile:
      dest: /etc/sudoers
      state: present
      regexp: '^{{ my_group }}'
      line: '{{ my_group }} ALL=(ALL) NOPASSWD:ALL'
      validate: 'visudo -cf %s'
  # - name: delete home directory
  #   ansible.builtin.file:
  #     path: "/home/{{ my_user }}"
  #     state: absent
  # - name: Create new group
  #   ansible.builtin.group:
  #     name: "{{ my_group }}"
  #     state: absent
  - name: Create new user
    ansible.builtin.user:
      name: "{{ my_user }}"
      state: present
